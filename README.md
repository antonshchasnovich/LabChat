# LabChat
Создание чата для обслуживания клиентов. Java | JS лаба#4 TouchSoft

Часть 1
Необходимый функционал:
* Два типа пользователей: “клиент” и “агент”, которые могут общаться друг с другом.
* Поддерживаются только личные сообщения клиента с агентом (клиент не может писать другому клиенту, а агент - другому агенту).
* Когда клиент начинает писать сообщение, он ещё не знает, с каким агентом он будет общаться.
* При получении первого сообщения клиента сервер должен выбрать свободного агента в качестве собеседника.
* Агент может вести беседу одновременно только с одним клиентом.
* Должны поддерживаться консольные команды для регистрации в системе, завершения чата и выходы из системы.
Технические требования:
* Автоматическая сборка проекта посредством Apache Maven
* Покрытие кода unit-тестами
* Логирование основных событий с указанием времени:
** Появления агента и клиента в системе
** Начало и завершение чата
Пример варианта использования:
1. Запускаем сервер
2. Запускаем клиентское приложение
3. Вводим “/register agent Cooper”
4. Сервер регистрирует нас как агента
5. Запускаем ещё один экземпляр клиентского приложения
6. Вводим “/register client Alice”
7. Сервер регистрирует нового клиента
8. Клиент вводит “Hello, I need help”
9. Агент получает сообщение и может ему ответить “How can I help you?”
10. Клиент может продолжить переписку или завершить чат: “/leave”
11. После завершения чата клиент может снова написать сообщение и, возможно, попасть на другого агента
12. Клиент или агент может выйти из системы, введя “/exit”, в этом случае приложение закрывается. 

Часть 2
В текущем задании необходимо добавить веб-интерфейс для вашего агентского/клиентского приложения. Он должен быть представлен в виде веб-страницы со следующими элементами: поле для ввода сообщений, поле для вывода сообщений, кнопка для отправки сообщений. При этом, должна сохраняться обратная совместимость с вашим консольным приложением таким образом, чтобы консольный агент мог общаться с веб-клиентами и консольные клиенты могли общаться с веб-агентами.
Если не знаете, как подступиться к данному заданию, вот немного советов:
Для начала выберите технологию, по которой веб-клиенты будут слать сообщения. Предлагаю одну из следующих: AJAX, WebSocket или STOMP. Если выбираете AJAX, то почитайте про short-polling и long-polling предварительно.
Если выбираете WebSocket или STOMP, то вам придётся использовать один из серверов приложений (например, Apache Tomcat) или Spring, реализующие спецификацию WebSocket-сервера.
Если выбираете AJAX, то можно обойтись без томката, тогда вам придётся реализовать поддержку http сервера с помощью либ (например Apache HttpComponents) либо парсить запросы самим.
Можно пойти по пути AJAX + Servlet, тогда вам снова понадобится сервер приложений (например, Apache Tomcat) уже как контейнер сервлетов.
Можете идти по пути Spring (Spring Boot, Spring WebSocket, Spring Stomp, Sptring MVC), если уже знаете, что это такое.
Надо понимать, что ваш сервер сам по себе является своего рода "томкатом", но реализующим ваш собственный протокол, когда как томкат реализует стандартные протоколы http, https, websocket, и т.д.
Как подружить ваш сервер и Apache Tomcat?
1. Можно в рамках томката реализовать поддержку вашего протокола и, соответственно, слушать ещё один порт. С этим может помочь ServletContextListener.
2. Можно создать свой коннектор для томката (типа <Connector port="8080" protocol="com.example.MyConnector" >). Это может быть элегантный, но не очень простой вариант.
3. В дополнение к этому, можно переписать ваш консольный клиент под websocket(или stomp) вместо вашего собственного протокола так, что и консольный клиент и браузер будут слать одинаковые запросы, тогда их можно одинаково обрабатывать томкатом. В этом случае надо, фактически, полностью переписать ваше клиентское приложение, трудоёмкий враиант.
Что почитать (Web, Servet/JSP):
1. Гонсалвес Э. - Изучаем Java EE 7 - 2014 - Глава 1. Понимание Java EE - c.22-34
2. Head First Servlets and JSP 2nd Edition - 2008 - p.1-140 (там много картинок, так что объём не такой уж большой)
3. Joel Murach, Michael Urban - Java Servlets and JSP (3rd edition) - 2014 - Section 1, 2
4. JSR-000340 Java Servlet 3.1 Specification
WebSocket/Stomp достаточно изучить по примерам, можно нагуглить по запросам типа "java websocket example".
  
 Часть 3
 Необходимо добавить возможность для веб-агентов участвовать одновременно в нескольких чатах. Количество таких слотов должно конфигурироваться при регистрации агента в веб-интерфейсе. Далее, при получении чатов от нескольких клиентов, у агента должны появляться табы, позволяющие переключаться между чатами в любое время. Также должна присутствовать кнопка, позволяющая закрыть текущий открытый чат. При входе в консольный интерфейс количество слотов для каждого агента остаётся равным 1 (т.е. консольный агент не может поддерживать более 1 чата одновременно).
